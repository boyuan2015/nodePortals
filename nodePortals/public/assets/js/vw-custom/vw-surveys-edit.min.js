(function(k,d,g){var j={idFormCreate:"frmEditSurvey",idBtnCreate:"btnUpdate",idBtnCreateQuestion:"btnAddQuestion",idFormCreateQuestion:"frmAddQuestion",objLadda:null};var n=function(){var s=k(":input");var p=[];for(var q=0;q<s.length;q++){var r=s[q];if(r.id!=g&&r.id.indexOf("txtQuestionChoice")!=-1&&r.id.indexOf("-error")==-1){p.push(r)}}return p};var f=function(){var p=n();var t=[];for(var r=0;r<p.length;r++){var q=p[r];var s=k(q).val();if(s!=""){t.push(s)}}return t};var h=function(){k.validator.addMethod("validateNumberOfChoices",function(q,p){var r=f();if(r.length<2){return false}return true},"Require at least 2 choices");k.validator.addMethod("validateDuplicatedOfChoices",function(s,r){var t=f();var p=t.sort();for(var q=0;q<p.length-1;q++){if(p[q+1]==p[q]){return false}}return true},"There are some duplicated choices")};var c=function(){k("#ddlQuestionDisplay").find("option").remove();var r=0;var q=0;var s=k("#collapseinSurvey").children();for(var p=0;p<s.length;p++){$obj=k(s[p]);if($obj.is("div")&&$obj.hasClass("survey-div-body")){q++;if(k("#hidSurveyType").val()=="UX"){$chk=$obj.find("input:checkbox");if($chk.is(":checked")){r++}}else{r=q}}}for(var p=1;p<=q;p++){if(p==r){k("#ddlQuestionDisplay").append('<option value="'+p+'" selected>'+p)}else{k("#ddlQuestionDisplay").append('<option value="'+p+'">'+p)}}};var m=function(){var p=k("#collapseinSurvey").find("input:checkbox:checked");var r=[];for(var q=0;q<p.length;q++){r.push(k(p[q]).val())}k("#hidCheckedQuestionIds").val(r.join())};var b=function(){k("#"+j.idBtnCreate).click(function(){k("#"+j.idFormCreate).validate({submitHandler:function(q){var r=k("#ddlQuestionDisplay").val();var p=0;k('input[name="checkQuestion[]"]').each(function(){if(k(this).prop("checked")==true){p++}});if(p!=r){VWUtility.showDismissibleAlert("#panel-body",VWUtility.getAlertTypes().ALERT_TYPE_DANGER,"Error:","Please choose the questions up to "+r+" questions.");return}a(q)}})})};var i=function(){k("#"+j.idBtnCreate).click(function(){k("#"+j.idFormCreate).validate({submitHandler:function(p){a(p)}})})};var l=function(){h();k("#"+j.idBtnCreateQuestion).click(function(){var t=k(this);var q=n();var p={};for(var s=0;s<q.length;s++){var r=q[s];p[r.id]={validateNumberOfChoices:true}}k("#"+j.idFormCreateQuestion).validate({rules:p,submitHandler:function(v){var w=k("#txtQuestionText").val();var u=k("#selQuestionType").val();var x=f();e(v,w,u,x)}})})};var e=function(s,t,q,u){var r=k("#"+j.idBtnCreateQuestion);j.objLadda=Ladda.create(r.get(0));j.objLadda.start();var p={success:function(v){if((v!=null)&&(v.toLowerCase().indexOf("error")===-1)){d.addQuestionToList(t,q,u,v);VWUtility.resetLadda(j.objLadda);VWUtility.showDismissibleAlert("#panel-body",VWUtility.getAlertTypes().ALERT_TYPE_SUCCESS,"Success:","Added a new Question.")}else{if(v!=null){VWUtility.resetLadda(j.objLadda);VWUtility.showDismissibleAlert("#panel-body",VWUtility.getAlertTypes().ALERT_TYPE_DANGER,"Error:","Could not add a new Question.");console.log("Error #1")}}},error:function(){VWUtility.resetLadda(j.objLadda);VWUtility.showDismissibleAlert("#panel-body",VWUtility.getAlertTypes().ALERT_TYPE_DANGER,"Error:","Could not add a new Question.");console.log("Error #2")}};k(s).ajaxSubmit(p)};var a=function(q){$btn=k("#"+j.idBtnCreate);j.objLadda=Ladda.create($btn.get(0));j.objLadda.start();var p={success:function(r){if((r!=null)&&(r.toLowerCase().indexOf("error")===-1)){if(location.href.indexOf("page=scheduled")>-1){location.href="/survey/schedule?status=edited"}else{location.href="/survey?status=edited"}}else{if(r!=null){VWUtility.showDismissibleAlert("#panel-body",VWUtility.getAlertTypes().ALERT_TYPE_DANGER,"Error:","Could not edit the Survey.");VWUtility.resetLadda(j.objLadda);console.log("Error #1")}}},error:function(){VWUtility.showDismissibleAlert("#panel-body",VWUtility.getAlertTypes().ALERT_TYPE_DANGER,"Error:","Could not edit the Survey.");VWUtility.resetLadda(j.objLadda);console.log("Error #2")}};m();k(q).ajaxSubmit(p)};d.onAddAnotherQuestionClick=function(){k("#aAddAnotherQuestion").hide();k("#divAddQuestionPanel").show("blind",300)};d.onAddAnotherChoiceClick=function(){var v=n();var r=1;var t=0;for(var q=0;q<v.length;q++){var p=v[q];var u=parseInt(p.id.replace("txtQuestionChoice",""));if(u>t){t=u}}r+=t;var s="";if(r<=2){s='<div class="input-group"><input type="text" class="form-control" style="width: 418px" id="txtQuestionChoice'+r+'" name="txtQuestionChoice'+r+'" placeholder="choice '+r+'"></div>'}else{s='<div class="input-group" id="divChoice'+r+'"><input type="text" class="form-control" id="txtQuestionChoice'+r+'" name="txtQuestionChoice'+r+'" placeholder="choice '+r+'"><span class="input-group-btn" style="vertical-align: top;"><button class="btn btn-default btn-delete-rf-id-tag vw-tooltip" type="button" data-toggle="tooltip" data-placement="top" title="Delete this choice" data-rf-id="3" onclick="VWSurveyEdit.removeChoice('+r+')"><i class="fa fa-times"></i></button></span></div>'}k("#divChoices").append(s)};d.removeChoice=function(p){k("#divChoice"+p).remove()};d.resetAddAnotherQuestionView=function(){k("#txtQuestionText").val("");k("#selQuestionType").val("RADIO");k("#divChoices").empty();k("#aAddMoreChoice").show();d.onAddAnotherChoiceClick();d.onAddAnotherChoiceClick();k("#aAddAnotherQuestion").show("blind",300);k("#divAddQuestionPanel").hide("blind",300)};d.addQuestionToList=function(u,t,w,v){v=v.trim();var q="";w.forEach(function(x){q+='<label class="radio-inline">'+x+"</label><br/>"});var p="";if(k("#hidSurveyType").val()!="UX"){p+=" disabled"}var r='<div id="divQuestion'+v+'" class="survey-div-body"><div class="row" style="margin-top: 1em;"><div class="col-sm-10"><input id="checkQuestion[]" name="checkQuestion[]" type="checkbox" value="'+v+'" '+p+' class="checkbox-inline">&nbsp;&nbsp;'+u+'</div><div class="col-sm-2" style="padding-right: 30px; text-align: right;"><a href="javascript:;" class="btn btn-default btn-xs ladda-button" data-style="contract" onclick="VWSurveyEdit.deleteQuestion('+v+', this)">Delete</a></div></div><div class="form-group"><div class="col-sm-6">'+q+"</div></div></div>";k("<hr/>").insertBefore("#divAddQuestionPanel");k(r).insertBefore("#divAddQuestionPanel");d.resetAddAnotherQuestionView();c();var s=k("#hidQuestionIds").val();if(s.length==0){s=v}else{s+=","+v}k("#hidQuestionIds").val(s)};d.deleteQuestion=function(q,p){$btn=k(p);j.objLadda=Ladda.create($btn.get(0));j.objLadda.start();k.ajax({url:"/survey/"+q+"/detroyNewQuestion",success:function(r){VWUtility.resetLadda(j.objLadda);if(r.indexOf("error")===-1){VWUtility.showDismissibleAlert("#panel-body",VWUtility.getAlertTypes().ALERT_TYPE_SUCCESS,"Success:","Delete question.");var x=k("#collapseinSurvey").find("div#divQuestion"+q);var t=k(x[0]);var s=t.next();if(s.is("hr")){s.remove()}else{var u=t.prev();if(u.is("hr")){u.remove()}}t.remove();var w=k("#hidQuestionIds").val();var v=w.split(",");v.splice(v.indexOf(q),1);w=v.join();k("#hidQuestionIds").val(w);c()}else{console.log(r)}}})};var o=function(){if(k("#hidSurveyType").val()=="UX"){b()}else{i()}m();l();k("#aAddAnotherQuestion").show();k("#divAddQuestionPanel").hide();k("#liRestaurants, #liSelectedRestaurant, #liSurvey").addClass("open, active").find("ul:first").css("display","block")};o()}(jQuery,window.VWSurveyEdit=window.VWSurveyEdit||{}));