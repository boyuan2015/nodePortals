(function(i,k,d){var f={classBtnDeleteRfIdTag:"btn-delete-rf-id-tag",classFormGroupChargers:"form-group-chargers",classRfIdDiv:"rf-id-div",classSpinnerIcon:"fa-spinner",classTimesIcon:"fa-times",classContainerDataTable:"container-data-table",classBtnAuthorize:"btn-authorize",classBtnDeauthorize:"btn-deauthorize",classBtnDeprovision:"btn-deprovision",classTdAuthStatus:"td-auth-status",idFormCreateOrUpdateBaseStation:"frmCreateOrUpdateBaseStation",idBtnCreateOrUpdateBaseStation:"btnCreateOrUpdateBaseStation",idFormCreateOrUpdateChargingStations:"frmCreateOrUpdateChargingStations",idBtnCreateOrUpdateChargingStations:"btnCreateOrUpdateChargingStations",idTimePickerControl:"txtBaseStationUpdateTime",idHfHwId:"hfHwId",idHfRfIdCollection:"hfRfIdCollection",idAAddRfIdTag:"a-add-rf-id-tag",idDtRails:"dt-rails",textConfirmationRequired:"Confirmation Required",textCreateChargingStation:"Create Charging Station",textActionDescriptionBase:"Would you like to {0} this item?",textMessageDelete:"Delete",textNoStationsToDisplay:"There are no stations to display.",textRailAuthorize:"Authorize",textRailDeauthorize:"Deauthorize",textRailDeprovision:"Deprovision",urlBaseStation:"/hardware/baseStation",urlStoreBaseStation:"/hardware/storeBaseStation",urlUpdateBaseStation:"/hardware/{id}/updateBaseStation",urlStoreChargingStation:"/hardware/storeChargingStation",urlDeleteChargingStation:"/hardware/{id}/deleteChargingStation",urlGetChargingStations:"/hardware/{id}/chargingStations",objLadda:null,numRfIdRowCount:0,htmlCenterEmText:'<div class="text-center"><em>{$}</em></div>',rails:{actionTypes:{deprovisionRail:"deprovisionRail",authorizeRail:"authorizeRail",deauthorizeRail:"deauthorizeRail"}}};var e=function(){if(i("#"+f.idDtRails).length){f.objSpinner=VWUtility.createSpinner("."+f.classContainerDataTable);var p=i("#"+f.idDtRails);p.dataTable({aaSorting:[[1,"asc"]],aoColumns:[null,null,null,{bSortable:false}],initComplete:function(r,q){setTimeout(function(){VWUtility.resetSpinner(f.objSpinner);i("."+f.classContainerDataTable).css("visibility","visible")},f.intSpinnerRemoveDelay)}});h(f.rails.actionTypes.deauthorizeRail);h(f.rails.actionTypes.authorizeRail);h(f.rails.actionTypes.deprovisionRail)}else{i("."+f.classContainerDataTable).css("visibility","visible")}};var h=function(p){switch(p){case f.rails.actionTypes.deauthorizeRail:i("."+f.classBtnDeauthorize).off().on({click:function(){var s=i(this);var t=s.data("id");var q=s.parents("tr");var r="<strong>RAIL - "+f.textConfirmationRequired+"</strong><br />";bootbox.confirm(r+f.textActionDescriptionBase.format({0:f.textRailDeauthorize}),function(u){if(u){a(s,f.rails.actionTypes.deauthorizeRail,t,q)}})}});break;case f.rails.actionTypes.authorizeRail:i("."+f.classBtnAuthorize).off().on({click:function(){var s=i(this);var t=s.data("id");var q=s.parents("tr");var r="<strong>RAIL - "+f.textConfirmationRequired+"</strong><br />";bootbox.confirm(r+f.textActionDescriptionBase.format({0:f.textRailAuthorize}),function(u){if(u){a(s,f.rails.actionTypes.authorizeRail,t,q)}})}});break;case f.rails.actionTypes.deprovisionRail:i("."+f.classBtnDeprovision).off().on({click:function(){var s=i(this);var t=s.data("id");var q=s.parents("tr");var r="<strong>RAIL - "+f.textConfirmationRequired+"</strong><br />";bootbox.confirm(r+f.textActionDescriptionBase.format({0:f.textRailDeprovision}),function(u){if(u){a(s,f.rails.actionTypes.deprovisionRail,t,q)}})}});break}};var m=function(){i.validator.addMethod("ipAddress",function(t){var q=t.split(".");if(q.length!=4){return false}for(var p=0;p<q.length;p++){var r=q[p];if(r.length==0||isNaN(r)||r<0||r>255){return false}}return true}," Invalid IP Address.");i.validator.addMethod("macAddress",function(q){var p=/^([0-9a-f]{1,2}[\.:-]){5}([0-9a-f]{1,2})$/i;return p.test(q)}," Invalid MAC Address.");i.validator.addMethod("unique",function(t,q,u){var s=u;var p=jQuery.validator.format("[name!='{0}'][unique='{1}']",q.name,s);var r=new Array();i(p).each(function(v,w){if(t==i(w).val()){r.push(w)}});return r.length==0},"Value is not unique.");i("#"+f.idTimePickerControl).timepicker({minuteStep:1,appendWidgetTo:"body",showSeconds:true,showMeridian:false,defaultTime:false});i("#"+f.idBtnCreateOrUpdateBaseStation).click(function(){var p=i(this);i("#"+f.idFormCreateOrUpdateBaseStation).validate({rules:{txtMacAddress:{macAddress:true},txtRailIpRange:{ipAddress:true}},submitHandler:function(q){f.objLadda=Ladda.create(p.get(0));f.objLadda.start();g(q)}})});i("#"+f.idAAddRfIdTag).on({click:function(){f.numRfIdRowCount++;var p=f.numRfIdRowCount;var q=i('<div class="row rf-id-row rf-id-row-extra row-mgn1 required"><label for="txtRfIdTag'+p+'" class="col-sm-2 control-label">RFID Tag</label><div class="col-sm-6"><div class="input-group"><input id="txtRfIdTag'+p+'" name="txtRfIdTag'+p+'" type="text" class="form-control form-control-rf-id-tag" minlength="16" maxlength="16" unique="rfid" required /><span class="input-group-btn"><button class="btn btn-default btn-clear-rf-id-tag vw-tooltip" type="button" data-toggle="tooltip" data-placement="top" title="Clear RFID Tag"><i class="fa fa-minus-circle"></i></button></span></div></div>');q.find(".vw-tooltip").tooltip();q.find(".btn-clear-rf-id-tag").on({click:function(){i(this).parents(".rf-id-row").remove();j()}});i("."+f.classRfIdDiv).append(q);q.find("input").focus();j()}});l();i("#"+f.idBtnCreateOrUpdateChargingStations).click(function(){var p=i(this);i.validator.addClassRules("form-control-rf-id-tag",{unique:true});i("#"+f.idFormCreateOrUpdateChargingStations).validate({submitHandler:function(q){f.objLadda=Ladda.create(p.get(0));f.objLadda.start();c(q)}})})};var l=function(){i("."+f.classBtnDeleteRfIdTag).on({click:function(){var q=i(this);var p="<strong>RFID Tag - "+f.textConfirmationRequired+"</strong><br />";bootbox.confirm(p+f.textActionDescriptionBase.format({0:f.textMessageDelete}),function(r){if(r){q.find("i").addClass(f.classSpinnerIcon).removeClass(f.classTimesIcon);var s=q.data("rf-id");o(s,q)}})}})};var j=function(){if(i(".form-control-rf-id-tag").length>1){i("#"+f.idBtnCreateOrUpdateChargingStations).text(f.textCreateChargingStation+"s")}else{i("#"+f.idBtnCreateOrUpdateChargingStations).text(f.textCreateChargingStation)}};var g=function(r){var p={dataType:"json",success:function(s){var t=i.parseJSON(s);if((t!=null)&&(t.success)){window.location=(f.urlBaseStation+"?status="+t.status)}else{if(t!=null){VWUtility.resetLadda(f.objLadda)}}},error:function(){VWUtility.resetLadda(f.objLadda)}};if(i("#"+f.idHfHwId).length){var q=i("#"+f.idHfHwId).val();p.url=f.urlUpdateBaseStation.replace("{id}",q);p.data={id:q,_method:"PUT"}}else{p.url=f.urlStoreBaseStation}i(r).ajaxSubmit(p)};var b=function(){var p=i("#hfHardwareId").val();i.ajax({type:"POST",url:(f.urlGetChargingStations.replace("{id}",p)),data:{id:p},success:function(q){if(q!=null){i("."+f.classFormGroupChargers).html(q);i("."+f.classRfIdDiv).find(".rf-id-row-extra").remove();i("#txtRfIdTag0").val("");l()}else{if(q!=null){console.log("getChargingStations #1:")}}VWUtility.resetLadda(f.objLadda)},error:function(){console.log("getChargingStations Error #2")}})};var o=function(p,r){var q=function(){r.find("i").addClass(f.classTimesIcon).removeClass(f.classSpinnerIcon)};i.ajax({type:"POST",url:(f.urlDeleteChargingStation.replace("{id}",p)),data:{_method:"DELETE"},dataType:"json",success:function(s){if((s!=null)&&(s.success)){i("#txt_"+p).parents(".rf-id-row").remove();var t=i("."+f.classFormGroupChargers);if(t.find(".rf-id-row").length===0){t.html(f.htmlCenterEmText.replace("{$}",f.textNoStationsToDisplay))}VWUtility.showDismissibleAlert("#panelBodyChargers",VWUtility.getAlertTypes().ALERT_TYPE_SUCCESS,"Success:","Deleted the Charging Station.")}else{if(s!=null){q()}}},error:function(){q()}})};var c=function(s){var r="";i(s).find(".form-control-rf-id-tag").each(function(){if(r!==""){r+=","}r+=i(this).val()});i("#"+f.idHfRfIdCollection).val(r);var p=function(v){var u="";var w="";var t=i.parseJSON(v);t.forEach(function(x){if(x.success){if(u.length===0){u+="Created new Charging Station(s) - "}u+=" ("+x.rfIdTag+")"}else{if(w.length===0){w+="Problem creating Charging Station(s) - "}w+=" ("+x.rfIdTag+" - "+x.status+")"}});if(u.length>0){u+="."}if(w.length>0){w+="."}if(w.length>0){VWUtility.showDismissibleAlert("#panelBodyChargers",VWUtility.getAlertTypes().ALERT_TYPE_DANGER,"Error:",w)}if(u.length>0){VWUtility.showDismissibleAlert("#panelBodyChargers",VWUtility.getAlertTypes().ALERT_TYPE_SUCCESS,"Success:",u,true)}};var q={url:f.urlStoreChargingStation,dataType:"json",success:function(t){var u=i.parseJSON(t);if((u!=null)&&(u.success)){if((u.status==="multiple")&&u.data!=null){p(u.data)}else{VWUtility.showDismissibleAlert("#panelBodyChargers",VWUtility.getAlertTypes().ALERT_TYPE_SUCCESS,"Success:","Created new Charging Station.")}b()}else{if(u!=null){VWUtility.showDismissibleAlert("#panelBodyChargers",VWUtility.getAlertTypes().ALERT_TYPE_DANGER,"Error:","Problem creating Charging Station ("+u.status+").");VWUtility.resetLadda(f.objLadda)}}},error:function(){VWUtility.resetLadda(f.objLadda)}};i(s).ajaxSubmit(q)};var a=function(q,s,r,t){f.objLadda=Ladda.create(q.get(0));f.objLadda.start();var p=("/hardware/{id}/"+s).format({id:r});i.ajax({type:"POST",url:p,data:{_method:"PUT"},dataType:"json",success:function(u){if((u!=null)&&(u.success)){var v="";switch(s){case f.rails.actionTypes.deauthorizeRail:v=f.textRailDeauthorize+"d";t.find("."+f.classTdAuthStatus).text("No");q.addClass(f.classBtnAuthorize).removeClass(f.classBtnDeauthorize).text(f.textRailAuthorize);h(f.rails.actionTypes.authorizeRail);break;case f.rails.actionTypes.authorizeRail:v=f.textRailAuthorize+"d";t.find("."+f.classTdAuthStatus).text("Yes");q.addClass(f.classBtnDeauthorize).removeClass(f.classBtnAuthorize).text(f.textRailDeauthorize);h(f.rails.actionTypes.deauthorizeRail);break;case f.rails.actionTypes.deprovisionRail:v=f.textRailDeprovision+"ed";t.remove();break}VWUtility.showDismissibleAlert("#panelBodyRails",VWUtility.getAlertTypes().ALERT_TYPE_SUCCESS,"Success:",v+" the RAIL item.")}else{if(u!=null){console.log("handleRailsAction #1:"+u.status)}}},error:function(){console.log("handleRailsAction Error #2")}}).always(function(){VWUtility.resetLadda(f.objLadda)})};var n=function(){e();m()};n()}(jQuery,window.VWBaseStation=window.VWBaseStation||{}));