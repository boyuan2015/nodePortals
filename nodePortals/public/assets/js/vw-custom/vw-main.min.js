(function(g,h,d){var f={idLiSelectedRestaurant:"liSelectedRestaurant",classBtnLaddaAuto:"btn-ladda-auto",textSelectedRestaurantIdDefault:"0",textSelectedRestaurantNameDefault:"None Selected",urlSelectedRestaurant:"/restaurant/selectedRestaurant",urlSelectedRestaurantPermission:"/restaurant/selectedRestaurantPermission",urlLogin:"/account/login",urlReset:"/account/reset/"};var c=function(){g(".vw-tooltip").tooltip();g.validator.setDefaults({highlight:function(p){g(p).closest(".form-group").addClass("has-error")},unhighlight:function(p){g(p).closest(".form-group").removeClass("has-error")},errorElement:"span",errorClass:"help-block",errorPlacement:function(p,q){if(q.parent(".input-group").length){p.insertAfter(q.parent())}else{p.insertAfter(q)}}});g("."+f.classBtnLaddaAuto).on({click:function(){var p=Ladda.create(g(this).get(0));p.start()}})};var e=function(){if((window.location.href.indexOf(f.urlLogin)===-1)&&(window.location.href.indexOf(f.urlReset)===-1)){var p=f.textSelectedRestaurantNameDefault;var q=f.textSelectedRestaurantIdDefault;g.getJSON(f.urlSelectedRestaurant,function(r){if(r.hasOwnProperty("name")&&r.hasOwnProperty("id")){p=r.name;q=r.id;n()}}).always(function(){m(p,q)})}};var n=function(){if((window.location.href.indexOf(f.urlLogin)===-1)&&(window.location.href.indexOf(f.urlReset)===-1)){g.getJSON(f.urlSelectedRestaurantPermission,function(p){permissions=p}).always(function(){i()})}};permissions=null;var l=function(p){if(this.permissions==null){return false}if(this.permissions.indexOf(p)==-1){return false}return true};var i=function(){a("liSelectedRestaurantEdit",l("Restaurants_Update"));a("liScheduledSurvey",l("Surveys_ByRestaurant"));a("liAddSurvey",l("Surveys_Create")&&l("Surveys_CreateSchedule"));a("liPos",l("Restaurants_GetPOS"));a("liHardware",l("BaseStations_GetDetails")&&l("Chargers_GetDetails"));a("liAddUser",l("Restaurants_AddUserToRestaurant"));a("liAddExistingUser",l("Restaurants_AddUserToRestaurant"))};var a=function(q,p){$element=g("#"+q);if(p){$element.removeClass("hideItem");$element.addClass("showItem");return true}$element.removeClass("showItem");$element.addClass("hideItem");return false};var m=function(p,r){var q=g("#"+f.idLiSelectedRestaurant);g("#spanSelectedRestaurantName").text(p);g("#spanSelectedRestaurantName").attr("data-restaurant-id",r);if((p!==f.textSelectedRestaurantNameDefault)&&(r!==f.textSelectedRestaurantIdDefault)){g("#liSelectedRestaurant").off("click");g("> a",q).removeClass("none-selected");q.removeClass("hideItem").addClass("showItem");g("#aSelectedRestaurantView").prop("href","/restaurant/"+r);g("#aSelectedRestaurantEdit").prop("href","/restaurant/"+r+"/edit");g("#aSelectedRestaurantPosEdit").prop("href","/pos/"+r+"/edit");g("#aSelectedRestaurantUsers").prop("href","/restaurant/"+r+"/users");updateMenuAnchor()}else{g("> a",q).addClass("none-selected");q.on({click:function(s){s.stopPropagation()}})}};var b=function(){g("#liSelectedRestaurant").removeClass("showItem").addClass("hideItem")};var k=function(){g(document).ajaxError(function(r,s,q,p){if(s.status===401){j()}})};var j=function(){var p="<strong>Sorry, your session has expired!</strong><br />";var q="If you would like to sign in to the system again, click 'OK'.";bootbox.alert(p+q,function(){window.location=f.urlLogin})};var o=function(){k();c();e()};o()}(jQuery,window.VWMain=window.VWMain||{}));