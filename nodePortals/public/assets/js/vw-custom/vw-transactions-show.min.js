$().ready(function(){var a={classLaddaBtn:"ladda-button",urlPaymentRefund:"/payment/refund",urlTransactionEmail:"/transaction/email"};$("#dt-transaction-detail").dataTable({paging:false,ordering:false,filter:false,info:false});$(".btn-refund-toggle").click(function(){var b=$(this).data("payment-id");$("input:hidden[name='hidRefundPaymentId']").val(b);$("#div-submit-refund").show()});$("#btnIssueRefund").click(function(){var b=Ladda.create($(this).get(0));$("#frmRefunds").validate({submitHandler:function(e){b.start();var c=$("input:hidden[name='hidRefundPaymentId']").val();var f=$("input:text[name='txtRefundAmount']").val();var d=$("textarea[name='txtRefundMessage']").val();var g=$("#lnkTransactionId").text();$.ajax({url:a.urlPaymentRefund,type:"POST",dataType:"html",data:{id:c,amount:f,reason:d},success:function(i){var h=jQuery.parseJSON(i);console.log(h.success);if(h.success){VWUtility.showDismissibleAlert("#panel-body",VWUtility.getAlertTypes().ALERT_TYPE_SUCCESS,"Success:",h.status);$.get("/transaction/"+g+"/getRefunds",function(l){l=JSON.parse(l);if($("#dt-transaction-refunds-detail").find("tr").length%2==0){$("#dt-transaction-refunds-detail tr:last").after("<tr></tr>")}$("#dt-transaction-refunds-detail").find("tr:gt(0)").hide();for(var j in l){if(j==="length"||!l.hasOwnProperty(j)){continue}var k=l[j];k.forEach(function(m){$("#dt-transaction-refunds-detail tr:last").after("<tr><td>"+j+"</td><td>"+m.referenceCode+"</td><td>"+m.entryDate+"</td><td>"+((m.reason!=null)?m.reason:"")+"</td><td>$"+String(m.amount).replace("-","")+"</td></tr>")})}$("input:text[name='txtRefundAmount']").val("");$("textarea[name='txtRefundMessage']").val("");$("#div-submit-refund").hide()})}else{VWUtility.showDismissibleAlert("#panel-body",VWUtility.getAlertTypes().ALERT_TYPE_DANGER,"Error:",h.status)}},error:function(h){VWUtility.showDismissibleAlert("#panel-body",VWUtility.getAlertTypes().ALERT_TYPE_DANGER,"Error:",h.responseText)}}).always(function(){VWUtility.resetLadda(b);VWUtility.scrollToTop()})}})});$("#btnEmail").click(function(){var c=Ladda.create($(this).get(0));c.start();var d=$("#lnkTransactionId").data("transactionid");var b=$("#txtEmailAddress").val();$.ajax({url:a.urlTransactionEmail,type:"POST",dataType:"html",data:{id:d,email:b},success:function(f){var e=jQuery.parseJSON(f);console.log(e.success);if(e.success){VWUtility.showDismissibleAlert("#panel-body",VWUtility.getAlertTypes().ALERT_TYPE_SUCCESS,"Success:",e.status)}else{VWUtility.showDismissibleAlert("#panel-body",VWUtility.getAlertTypes().ALERT_TYPE_DANGER,"Error:",e.status)}},error:function(e){VWUtility.showDismissibleAlert("#panel-body",VWUtility.getAlertTypes().ALERT_TYPE_DANGER,"Error:",e.responseText)}}).always(function(){VWUtility.resetLadda(c)})})});