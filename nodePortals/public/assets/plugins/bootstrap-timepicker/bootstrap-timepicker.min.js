/*!
 * Timepicker Component for Twitter Bootstrap 3
 *
 * Copyright 2014 Nathan Hollingsworth
 *
 * Forked from: https://github.com/jdewit/bootstrap-timepicker
 *
 * For the full copyright and license information, please view the LICENSE
 * file that was distributed with this source code.
 */
(function(d,c,a,e){var b=function(h,g){this.widget="";this.$element=d(h);this.defaultTime=g.defaultTime;this.disableFocus=g.disableFocus;this.disableMousewheel=g.disableMousewheel;this.isOpen=g.isOpen;this.minuteStep=g.minuteStep;this.modalBackdrop=g.modalBackdrop;this.orientation=g.orientation;this.secondStep=g.secondStep;this.showInputs=g.showInputs;this.showMeridian=g.showMeridian;this.showSeconds=g.showSeconds;this.template=g.template;this.appendWidgetTo=g.appendWidgetTo;this.showWidgetOnAddonClick=g.showWidgetOnAddonClick;this.timeSeparator=g.separator;this._init()};function f(h,g){if(typeof(h)==="undefined"||typeof(g)==="undefined"){return false}if(typeof(h)!=="object"||!h.getMonth){throw new Error("date1 is not a Date object")}if(typeof(g)!=="object"||!g.getMonth){throw new Error("date2 is not a Date object")}return h.getHours()===g.getHours()&&h.getMinutes()===g.getMinutes()&&h.getSeconds()===g.getSeconds()}b.prototype={constructor:b,_init:function(){var g=this;if(this.showWidgetOnAddonClick&&this.$element.parent().hasClass("input-group")){this.$element.parent(".input-group").find(".input-group-addon").on({"click.timepicker":d.proxy(this.showWidget,this)});this.$element.on({"focus.timepicker":d.proxy(this.highlightUnit,this),"click.timepicker":d.proxy(this.highlightUnit,this),"keydown.timepicker":d.proxy(this.elementKeydown,this),"blur.timepicker":d.proxy(this.blurElement,this),"mousewheel.timepicker DOMMouseScroll.timepicker":d.proxy(this.mousewheel,this)})}else{if(this.template){this.$element.on({"focus.timepicker":d.proxy(this.showWidget,this),"click.timepicker":d.proxy(this.showWidget,this),"blur.timepicker":d.proxy(this.blurElement,this),"mousewheel.timepicker DOMMouseScroll.timepicker":d.proxy(this.mousewheel,this)})}else{this.$element.on({"focus.timepicker":d.proxy(this.highlightUnit,this),"click.timepicker":d.proxy(this.highlightUnit,this),"keydown.timepicker":d.proxy(this.elementKeydown,this),"blur.timepicker":d.proxy(this.blurElement,this),"mousewheel.timepicker DOMMouseScroll.timepicker":d.proxy(this.mousewheel,this)})}}if(this.template!==false){this.$widget=d(this.getTemplate()).on("click",d.proxy(this.widgetClick,this))}else{this.$widget=false}if(this.showInputs&&this.$widget!==false){this.$widget.find("input").each(function(){d(this).on({"click.timepicker":function(){d(this).select()},"keydown.timepicker":d.proxy(g.widgetKeydown,g),"keyup.timepicker":d.proxy(g.widgetKeyup,g)})})}this.setDefaultTime(this.defaultTime)},blurElement:function(){this.highlightedUnit=null;this.updateFromElementVal()},clear:function(){this.hour="";this.minute="";this.second="";this.meridian="";this.$element.val("")},decrementHour:function(){if(this.showMeridian){if(this.hour===1){this.hour=12}else{if(this.hour===12){this.hour--;return this.toggleMeridian()}else{if(this.hour===0){this.hour=11;return this.toggleMeridian()}else{this.hour--}}}}else{if(this.hour<=0){this.hour=23}else{this.hour--}}},decrementMinute:function(h){var g;if(h){g=this.minute-h}else{g=this.minute-this.minuteStep}if(g<0){this.decrementHour();this.minute=g+60}else{this.minute=g}},decrementSecond:function(){var g=this.second-this.secondStep;if(g<0){this.decrementMinute(true);this.second=g+60}else{this.second=g}},elementKeydown:function(g){switch(g.keyCode){case 9:case 27:this.updateFromElementVal();break;case 37:g.preventDefault();this.highlightPrevUnit();break;case 38:g.preventDefault();switch(this.highlightedUnit){case"hour":this.incrementHour();this.highlightHour();break;case"minute":this.incrementMinute();this.highlightMinute();break;case"second":this.incrementSecond();this.highlightSecond();break;case"meridian":this.toggleMeridian();this.highlightMeridian();break}this.update();break;case 39:g.preventDefault();this.highlightNextUnit();break;case 40:g.preventDefault();switch(this.highlightedUnit){case"hour":this.decrementHour();this.highlightHour();break;case"minute":this.decrementMinute();this.highlightMinute();break;case"second":this.decrementSecond();this.highlightSecond();break;case"meridian":this.toggleMeridian();this.highlightMeridian();break}this.update();break}},getCursorPosition:function(){var h=this.$element.get(0);if("selectionStart" in h){return h.selectionStart}else{if(a.selection){h.focus();var i=a.selection.createRange(),g=a.selection.createRange().text.length;i.moveStart("character",-h.value.length);return i.text.length-g}}},getTemplate:function(){var i,k,h,g,j,l;if(this.showInputs){k='<input type="text" name="hour" class="bootstrap-timepicker-hour form-control" maxlength="2"/>';h='<input type="text" name="minute" class="bootstrap-timepicker-minute form-control" maxlength="2"/>';g='<input type="text" name="second" class="bootstrap-timepicker-second form-control" maxlength="2"/>';j='<input type="text" name="meridian" class="bootstrap-timepicker-meridian form-control" maxlength="2"/>'}else{k='<span class="bootstrap-timepicker-hour"></span>';h='<span class="bootstrap-timepicker-minute"></span>';g='<span class="bootstrap-timepicker-second"></span>';j='<span class="bootstrap-timepicker-meridian"></span>'}l='<table><tr><td><a href="#" data-action="incrementHour"><i class="glyphicon glyphicon-chevron-up"></i></a></td><td class="separator">&nbsp;</td><td><a href="#" data-action="incrementMinute"><i class="glyphicon glyphicon-chevron-up"></i></a></td>'+(this.showSeconds?'<td class="separator">&nbsp;</td><td><a href="#" data-action="incrementSecond"><i class="glyphicon glyphicon-chevron-up"></i></a></td>':"")+(this.showMeridian?'<td class="separator">&nbsp;</td><td class="meridian-column"><a href="#" data-action="toggleMeridian"><i class="glyphicon glyphicon-chevron-up"></i></a></td>':"")+"</tr><tr><td>"+k+'</td> <td class="separator">'+this.timeSeparator+"</td><td>"+h+"</td> "+(this.showSeconds?'<td class="separator">'+this.timeSeparator+"</td><td>"+g+"</td>":"")+(this.showMeridian?'<td class="separator">&nbsp;</td><td>'+j+"</td>":"")+'</tr><tr><td><a href="#" data-action="decrementHour"><i class="glyphicon glyphicon-chevron-down"></i></a></td><td class="separator"></td><td><a href="#" data-action="decrementMinute"><i class="glyphicon glyphicon-chevron-down"></i></a></td>'+(this.showSeconds?'<td class="separator">&nbsp;</td><td><a href="#" data-action="decrementSecond"><i class="glyphicon glyphicon-chevron-down"></i></a></td>':"")+(this.showMeridian?'<td class="separator">&nbsp;</td><td><a href="#" data-action="toggleMeridian"><i class="glyphicon glyphicon-chevron-down"></i></a></td>':"")+"</tr></table>";switch(this.template){case"modal":i='<div class="bootstrap-timepicker-widget modal hide fade in" data-backdrop="'+(this.modalBackdrop?"true":"false")+'"><div class="modal-header"><a href="#" class="close" data-dismiss="modal">&times;</a><h3>Pick a Time</h3></div><div class="modal-content">'+l+'</div><div class="modal-footer"><a href="#" class="btn btn-primary" data-dismiss="modal">OK</a></div></div>';break;case"dropdown":i='<div class="bootstrap-timepicker-widget dropdown-menu">'+l+"</div>";break}return i},getTime:function(k){var g=this;function j(n){var o=n.toString();return(o.length>1)?o:"0"+o}function i(n){if(n){if(g.showMeridian){return g.hour}return(g.hour>12)?g.hour-12:g.hour}else{if(!g.showMeridian){return g.hour}if(g.meridian==="PM"){if(g.hour!==12){return g.hour+12}return g.hour}else{if(g.hour===12){return 0}return g.hour}}}function m(){if(g.showMeridian){return g.meridian}else{if(g.hour>=12){return"PM"}else{return"AM"}}}function h(n){switch(n){case"h":return j(i(true));case"H":return j(i(false));case"m":return j(g.minute);case"s":return j(g.second);case"a":return m();default:return n}}function l(q){var o={hh:"h",hH:"h",Hh:"h",HH:"H",mm:"m",ss:"s",A:"a"},n="",p;p=q;d.each(o,function(r,s){p=p.replace(r,s)});d.each(p.split(""),function(r,s){n+=h(s)});return n}if(g.hour===""){return""}if(k==="date"){return new Date(1970,0,1,i(false),g.minute,g.second,0)}if(k){return l(k)}return g.hour+g.timeSeparator+(g.minute.toString().length===1?"0"+g.minute:g.minute)+(g.showSeconds?g.timeSeparator+(g.second.toString().length===1?"0"+g.second:g.second):"")+(g.showMeridian?" "+g.meridian:"")},hideWidget:function(){if(this.isOpen===false){return}this.$element.trigger({type:"hide.timepicker",time:{value:this.getTime(),hours:this.hour,minutes:this.minute,seconds:this.second,meridian:this.meridian}});if(this.template==="modal"&&this.$widget.modal){this.$widget.modal("hide")}else{this.$widget.removeClass("open")}d(a).off("mousedown.timepicker, touchend.timepicker");this.isOpen=false;this.$widget.detach()},highlightUnit:function(){this.position=this.getCursorPosition();if(this.position>=0&&this.position<=2){this.highlightHour()}else{if(this.position>=3&&this.position<=5){this.highlightMinute()}else{if(this.position>=6&&this.position<=8){if(this.showSeconds){this.highlightSecond()}else{this.highlightMeridian()}}else{if(this.position>=9&&this.position<=11){this.highlightMeridian()}}}}},highlightNextUnit:function(){switch(this.highlightedUnit){case"hour":this.highlightMinute();break;case"minute":if(this.showSeconds){this.highlightSecond()}else{if(this.showMeridian){this.highlightMeridian()}else{this.highlightHour()}}break;case"second":if(this.showMeridian){this.highlightMeridian()}else{this.highlightHour()}break;case"meridian":this.highlightHour();break}},highlightPrevUnit:function(){switch(this.highlightedUnit){case"hour":if(this.showMeridian){this.highlightMeridian()}else{if(this.showSeconds){this.highlightSecond()}else{this.highlightMinute()}}break;case"minute":this.highlightHour();break;case"second":this.highlightMinute();break;case"meridian":if(this.showSeconds){this.highlightSecond()}else{this.highlightMinute()}break}},highlightHour:function(){var g=this.$element.get(0),h=this;this.highlightedUnit="hour";if(g.setSelectionRange){setTimeout(function(){if(h.hour<10){g.setSelectionRange(0,1)}else{g.setSelectionRange(0,2)}},0)}},highlightMinute:function(){var g=this.$element.get(0),h=this;this.highlightedUnit="minute";if(g.setSelectionRange){setTimeout(function(){if(h.hour<10){g.setSelectionRange(2,4)}else{g.setSelectionRange(3,5)}},0)}},highlightSecond:function(){var g=this.$element.get(0),h=this;this.highlightedUnit="second";if(g.setSelectionRange){setTimeout(function(){if(h.hour<10){g.setSelectionRange(5,7)}else{g.setSelectionRange(6,8)}},0)}},highlightMeridian:function(){var g=this.$element.get(0),h=this;this.highlightedUnit="meridian";if(g.setSelectionRange){if(this.showSeconds){setTimeout(function(){if(h.hour<10){g.setSelectionRange(8,10)}else{g.setSelectionRange(9,11)}},0)}else{setTimeout(function(){if(h.hour<10){g.setSelectionRange(5,7)}else{g.setSelectionRange(6,8)}},0)}}},incrementHour:function(){if(this.showMeridian){if(this.hour===11){this.hour++;return this.toggleMeridian()}else{if(this.hour===12){this.hour=0}}}if(this.hour===23){this.hour=0;return}this.hour++},incrementMinute:function(h){var g;if(h){g=this.minute+h}else{g=this.minute+this.minuteStep-(this.minute%this.minuteStep)}if(g>59){this.incrementHour();this.minute=g-60}else{this.minute=g}},incrementSecond:function(){var g=this.second+this.secondStep-(this.second%this.secondStep);if(g>59){this.incrementMinute(true);this.second=g-60}else{this.second=g}},mousewheel:function(h){if(this.disableMousewheel){return}h.preventDefault();h.stopPropagation();var i=h.originalEvent.wheelDelta||-h.originalEvent.detail,g=null;if(h.type==="mousewheel"){g=(h.originalEvent.wheelDelta*-1)}else{if(h.type==="DOMMouseScroll"){g=40*h.originalEvent.detail}}if(g){h.preventDefault();d(this).scrollTop(g+d(this).scrollTop())}switch(this.highlightedUnit){case"minute":if(i>0){this.incrementMinute()}else{this.decrementMinute()}this.highlightMinute();break;case"second":if(i>0){this.incrementSecond()}else{this.decrementSecond()}this.highlightSecond();break;case"meridian":this.toggleMeridian();this.highlightMeridian();break;default:if(i>0){this.incrementHour()}else{this.decrementHour()}this.highlightHour();break}return false},place:function(){if(this.isInline){return}var i=this.$widget.outerWidth(),p=this.$widget.outerHeight(),k=10,m=d(c).width(),h=d(c).height(),l=d(c).scrollTop();var s=parseInt(this.$element.parents().filter(function(){}).first().css("z-index"),10)+10;var o=this.component?this.component.parent().offset():this.$element.offset();var t=this.component?this.component.outerHeight(true):this.$element.outerHeight(false);var j=this.component?this.component.outerWidth(true):this.$element.outerWidth(false);var n=o.left,r=o.top;this.$widget.removeClass("timepicker-orient-top timepicker-orient-bottom timepicker-orient-right timepicker-orient-left");if(this.orientation.x!=="auto"){this.picker.addClass("timepicker-orient-"+this.orientation.x);if(this.orientation.x==="right"){n-=i-j}}else{this.$widget.addClass("timepicker-orient-left");if(o.left<0){n-=o.left-k}else{if(o.left+i>m){n=m-i-k}}}var g=this.orientation.y,q,u;if(g==="auto"){q=-l+o.top-p;u=l+h-(o.top+t+p);if(Math.max(q,u)===u){g="top"}else{g="bottom"}}this.$widget.addClass("timepicker-orient-"+g);if(g==="top"){r+=t}else{r-=p+parseInt(this.$widget.css("padding-top"),10)}this.$widget.css({top:r,left:n,zIndex:s})},remove:function(){d("document").off(".timepicker");if(this.$widget){this.$widget.remove()}delete this.$element.data().timepicker},setDefaultTime:function(i){if(!this.$element.val()){if(i==="current"){var g=new Date(),h=g.getHours(),k=g.getMinutes(),l=g.getSeconds(),j="AM";if(l!==0){l=Math.ceil(g.getSeconds()/this.secondStep)*this.secondStep;if(l===60){k+=1;l=0}}if(k!==0){k=Math.ceil(g.getMinutes()/this.minuteStep)*this.minuteStep;if(k===60){h+=1;k=0}}if(this.showMeridian){if(h===0){h=12}else{if(h>=12){if(h>12){h=h-12}j="PM"}else{j="AM"}}}this.hour=h;this.minute=k;this.second=l;this.meridian=j;this.update()}else{if(i===false){this.hour=0;this.minute=0;this.second=0;this.meridian="AM"}else{this.setTime(i)}}}else{this.updateFromElementVal()}},setTime:function(j,l){var n,o,m,k,h,i,g;if(!j){this.clear();return}if(typeof j==="object"&&j.getMonth){g=this.getTime("date");if(f(g,j)){return}m=j.getHours();k=j.getMinutes();h=j.getSeconds();if(this.showMeridian){i="AM";if(m>12){i="PM";m=m-12}if(m===12){i="PM"}}}else{if(j.match(/p/i)!==null){i="PM"}else{i="AM"}n=new RegExp("[^0-9\\"+this.timeSeparator+"]","g");j=j.replace(n,"");o=j.split(this.timeSeparator);m=o[0]?o[0].toString():o.toString();k=o[1]?o[1].toString():"";h=o[2]?o[2].toString():"";if(m.length>4){h=m.substr(4,2)}if(m.length>2){k=m.substr(2,2);m=m.substr(0,2)}if(k.length>2){h=k.substr(2,2);k=k.substr(0,2)}if(h.length>2){h=h.substr(2,2)}m=parseInt(m,10);k=parseInt(k,10);h=parseInt(h,10);if(isNaN(m)){m=0}if(isNaN(k)){k=0}if(isNaN(h)){h=0}if(this.showMeridian){if(m<1){m=1}else{if(m>12){m=12}}}else{if(m>=24){m=23}else{if(m<0){m=0}}if(m<13&&i==="PM"){m=m+12}}if(k<0){k=0}else{if(k>=60){k=59}}if(this.showSeconds){if(isNaN(h)){h=0}else{if(h<0){h=0}else{if(h>=60){h=59}}}}}this.hour=m;this.minute=k;this.second=h;this.meridian=i;this.update(l)},showWidget:function(){if(this.isOpen){return}if(this.$element.is(":disabled")){return}this.$widget.appendTo(this.appendWidgetTo);var g=this;d(a).on("mousedown.timepicker, touchend.timepicker",function(h){if(!(g.$element.parent().find(h.target).length||g.$widget.is(h.target)||g.$widget.find(h.target).length)){g.hideWidget()}});this.$element.trigger({type:"show.timepicker",time:{value:this.getTime(),hours:this.hour,minutes:this.minute,seconds:this.second,meridian:this.meridian}});this.place();if(this.disableFocus){this.$element.blur()}if(this.hour===""){if(this.defaultTime){this.setDefaultTime(this.defaultTime)}else{this.setTime("0"+this.timeSeparator+"0"+this.timeSeparator+"0")}}if(this.template==="modal"&&this.$widget.modal){this.$widget.modal("show").on("hidden",d.proxy(this.hideWidget,this))}else{if(this.isOpen===false){this.$widget.addClass("open")}}this.isOpen=true},toggleMeridian:function(){this.meridian=this.meridian==="AM"?"PM":"AM"},update:function(g){this.updateElement();if(!g){this.updateWidget()}this.$element.trigger({type:"changeTime.timepicker",time:{date:this.getTime("date"),value:this.getTime(),hours:this.hour,minutes:this.minute,seconds:this.second,meridian:this.meridian}})},updateElement:function(){this.$element.val(this.getTime()).change()},updateFromElementVal:function(){this.setTime(this.$element.val())},updateWidget:function(){if(this.$widget===false){return}var g=this.hour,i=this.minute.toString().length===1?"0"+this.minute:this.minute,h=this.second.toString().length===1?"0"+this.second:this.second;if(this.showInputs){this.$widget.find("input.bootstrap-timepicker-hour").val(g);this.$widget.find("input.bootstrap-timepicker-minute").val(i);if(this.showSeconds){this.$widget.find("input.bootstrap-timepicker-second").val(h)}if(this.showMeridian){this.$widget.find("input.bootstrap-timepicker-meridian").val(this.meridian)}}else{this.$widget.find("span.bootstrap-timepicker-hour").text(g);this.$widget.find("span.bootstrap-timepicker-minute").text(i);if(this.showSeconds){this.$widget.find("span.bootstrap-timepicker-second").text(h)}if(this.showMeridian){this.$widget.find("span.bootstrap-timepicker-meridian").text(this.meridian)}}},updateFromWidgetInputs:function(){if(this.$widget===false){return}var g=this.$widget.find("input.bootstrap-timepicker-hour").val()+this.timeSeparator+this.$widget.find("input.bootstrap-timepicker-minute").val()+(this.showSeconds?this.timeSeparator+this.$widget.find("input.bootstrap-timepicker-second").val():"")+(this.showMeridian?this.$widget.find("input.bootstrap-timepicker-meridian").val():"");this.setTime(g,true)},widgetClick:function(h){h.stopPropagation();h.preventDefault();var i=d(h.target),g=i.closest("a").data("action");if(g){this[g]()}this.update();if(i.is("input")){i.get(0).setSelectionRange(0,2)}},widgetKeydown:function(h){var i=d(h.target),g=i.attr("class").replace("bootstrap-timepicker-","");switch(h.keyCode){case 9:if((this.showMeridian&&g==="meridian")||(this.showSeconds&&g==="second")||(!this.showMeridian&&!this.showSeconds&&g==="minute")){return this.hideWidget()}break;case 27:this.hideWidget();break;case 38:h.preventDefault();switch(g){case"hour":this.incrementHour();break;case"minute":this.incrementMinute();break;case"second":this.incrementSecond();break;case"meridian":this.toggleMeridian();break}this.setTime(this.getTime());i.get(0).setSelectionRange(0,2);break;case 40:h.preventDefault();switch(g){case"hour":this.decrementHour();break;case"minute":this.decrementMinute();break;case"second":this.decrementSecond();break;case"meridian":this.toggleMeridian();break}this.setTime(this.getTime());i.get(0).setSelectionRange(0,2);break}},widgetKeyup:function(g){if((g.keyCode===65)||(g.keyCode===77)||(g.keyCode===80)||(g.keyCode===46)||(g.keyCode===8)||(g.keyCode>=46&&g.keyCode<=57)||(g.keyCode>=96&&g.keyCode<=105)){this.updateFromWidgetInputs()}}};d.fn.timepicker=function(h){var g=Array.apply(null,arguments),i;g.shift();return this.each(function(){var l=d(this),k=l.data("timepicker"),j=typeof h==="object"&&h;if(!k){i=d.extend({},d.fn.timepicker.defaults,j,d(this).data());l.data("timepicker",(k=new b(this,i)))}if(typeof h==="string"){k[h].apply(k,g)}})};d.fn.timepicker.defaults={defaultTime:"current",disableFocus:false,disableMousewheel:false,isOpen:false,minuteStep:15,modalBackdrop:false,orientation:{x:"auto",y:"auto"},secondStep:15,showSeconds:false,showInputs:true,showMeridian:true,template:"dropdown",appendWidgetTo:"body",showWidgetOnAddonClick:true,separator:":"};d.fn.timepicker.Constructor=b})(jQuery,window,document);